#!/usr/bin/env bash

BUILD_OPTS="--no-cache"

GITHUB_CONTAINER_REGISTRY_URL="ghcr.io/pauldaniv/yellow-taxi-scripts"
IMAGE_NAME=$1

if [[ -z "$IMAGE_NAME" ]]; then
  echo "No image specified..."
  exit 1
fi

cd "$(cd "$(dirname "$0")/.."; pwd)"

git_hash=$(git rev-parse --short "$GITHUB_SHA")
git_branch=${GITHUB_REF#refs/heads/}

echo $git_hash
echo git_branch

function build_image() {
    local image=$1
    local repo=$GITHUB_CONTAINER_REGISTRY_URL
    local image_tag="$repo/$image:latest" #todo: add commit hash
    echo "Building '$image_tag'..."
    docker build $BUILD_OPTS -t "$image_tag" "src/$image"
}

build_image "$IMAGE_NAME"
