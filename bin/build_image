#!/usr/bin/env bash

BUILD_OPTS="--no-cache"

GITHUB_CONTAINER_REGISTRY_URL="ghcr.io/pauldaniv/yellow-taxi-scripts"

function build_image() {
    local image=$1
    local repo=$2
    local image_tag="$repo/$image:latest"
    echo "Building '$image_tag'..."
    docker build $BUILD_OPTS -t "$image_tag" "src/$image"
}

function build_and_push_top_level_image() {
  build_image "$image" "$GITHUB_CONTAINER_REGISTRY_URL"
}

cd "$(cd "$(dirname "$0")/.."; pwd)"

if [[ ! -z "$1" ]]; then
  echo "No image specified..."
  exit 1
fi

build_and_push_top_level_image "$1"
